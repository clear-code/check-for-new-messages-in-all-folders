# Check New Messages in All Folders 仕様

## 概要

本アドオンはThunderbirdに対して、選択したIMAPメールアカウントのすべてのフォルダについて「このフォルダに新着メッセージがないか確認する」のチェック状態をONまたはOFFの状態に変更する機能を提供します。

## 動作

### 処理対象のメールアカウントの検出

本アドオンはThunderbird上で認識されているすべてのメールアカウントのうち、IMAPメールアカウントのみを処理対象とします。それ以外の種類のアカウントは、存在していても無視されます。

### 処理対象のフォルダの検出

本アドオンは、処理対象のメールアカウントに属していてローカルに要約情報が存在しているすべてのフォルダを処理対象とします。ただし、以下の条件に当てはまるフォルダは処理対象外とします。

 * 受信トレイとして認識されているフォルダ。
 * 仮想フォルダとして認識されているフォルダ。

まだ一度もログインしていないメールアカウントについては、ローカルに要約情報が存在しないため処理対象外となります。

### メニューの初期化

本アドオンは機能呼び出し用のメニューが開かれたことをトリガーとして動作を開始します。

メニューバーまたはアプリケーションメニューの「ツール」内の「新着メールの確認」メニューをユーザが展開しようとした瞬間に、本アドオンはすべての処理対象のメールアカウントについて、すべての処理対象のフォルダの「このフォルダに新着メッセージがないか確認する」のチェック状態に対応するフラグの値を確認します。

 * すべてのフォルダのチェック状態がONであれば、そのアカウントを「すべてのフォルダの新着メールを確認する設定になっている」と判断します。
 * 1つでもチェック状態がOFFであるフォルダが見つかった場合は、そのアカウントは「すべてのフォルダについて新着メールを確認する設定にはなっていない」と判断します。

この判断結果を用いて、本アドオンは各アカウントに対応するメニューのサブ項目を初期化します。

 * 「すべてのフォルダの新着メールを確認する設定になっている」と判断したアカウントは、サブ項目の「すべてのフォルダの新着メールを確認する」にチェックを付けます。
 * そうでなければ、サブ項目の「受信トレイの新着メールのみ確認する」にチェックを付けます。

### メニューの操作

「新着メールの確認」以下でユーザが選択可能なメニュー項目は、各アカウントに対応するメニュー内の以下の2つの項目となります。

 1. すべてのフォルダの新着メールを確認する
 2. 受信トレイの新着メールのみ確認する

1の項目をユーザが選択した場合、本アドオンは当該アカウントの処理対象のフォルダすべてについて、「すべてのフォルダの新着メールを確認する」のチェック状態に対応するフラグを設定（追加）します。

2の項目をユーザが選択した場合、本アドオンは当該アカウントの処理対象のフォルダすべてについて、「すべてのフォルダの新着メールを確認する」のチェック状態に対応するフラグを削除します。

## 制限事項

本アドオンは、新規に作成されたメールフォルダの「このフォルダに新着メッセージがないか確認する」のチェック状態を自動的に変更する機能を有しません。本アドオンを用いて全フォルダの当該チェックボックスをOFFにした後で、新たにフォルダを作成した場合、そのフォルダの当該チェックボックスの状態はONとなります。そのため、全フォルダの状態を統一するには、そのフォルダのプロパティを開き手動でチェックボックスをOFFにするか、改めて本アドオンを使うかする必要があります。
